# 前端应该懂的HTTPS协议知识点
## 什么是HTTPS协议
**超文本传输安全协议**（`Hypertext Transfer Protocol Secure，简称：HTTPS`）是一种通过计算机网络进行安全通信的传输协议。`HTTPS`经由`HTTP`进行通信，利用`SSL/TLS`来加密数据包。 `HTTPS`的主要目的是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fc896a61f7d4810811b2d47b2170e02~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

`HTTP协议`采用**明文传输**信息，存在**信息窃听**、**信息篡改**和**信息劫持**的风险，而协议`TLS/SSL`具有**身份验证**、**信息加密**和**完整性校验**的功能，可以避免此类问题发生。

安全层的主要职责就是**对发起的HTTP请求的数据进行加密操作**和**对接收到的HTTP的内容进行解密**操作。

## HTTP和HTTPS协议的区别
HTTP和HTTPS协议的主要区别如下：
- `HTTPS协议`需要`CA`证书，费用较高；而`HTTP协议`不需要
- `HTTP协议`是超文本传输协议，信息是**明文传输**的，`HTTPS`则是具有安全性的`SSL`**加密传输协议**
- 使用不同的连接方式，默认端口也不同，`HTTP协议`端口是**80**，`HTTPS`协议端口是**443**
- `HTTP协议`连接很简单，是**无状态**的；`HTTPS协议`是有`SSL`和`HTTP`协议构建的可进行加密传输、身份认证的网络协议，比`HTTP`**更加安全**。

## TLS/SSL的工作原理
`TLS`全称**安全传输层协议**（`Transport Layer Security`）及其前身**安全套接层**（`Secure Sockets Layer，缩写作SSL`） 是介于`TCP`和`HTTP`之间的一层安全协议，不影响原有的`TCP`协议和`HTTP`协议，所以使用`HTTPS`基本上不需要对`HTTP`页面进行太多的改造。

`TLS/SSL`的功能实现主要依赖三类基本算法：**散列函数hash**、**对称加密**、**非对称加密**。这三类算法的作用如下：
- 散列算法用来验证信息的完整性
- 对称加密算法采用协商的秘钥对数据加密
- 非对称加密实现身份认证和秘钥协商

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4c3d5b4b78c549d6b94fbff32a652cf1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

## 对称加密
### 概念
对称加密的特点是文件加密和解密**使用相同的密钥**，即加密密钥也可以用作解密密钥，这种方法在密码学中叫做**对称加密算法**。对称加密算法使用起来简单快捷，密钥较短，且破译困难，**通信的双⽅都使⽤同⼀个秘钥进⾏加密, 解密**。⽐如，两个人事先约定的暗号，就属于对称加密。
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72a94610b5ac436aa830861a9e15c712~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)
### 优点
计算量小、加密速度快、加密效率高。
### 缺点
**在数据传送前，发送方和接收方必须商定好秘钥，然后双方保存好秘钥。如果一方的秘钥被泄露，那么加密信息也就不安全了。** 最不安全的地方, 就在于第一开始, 互相约定密钥的时候!!! 传递密钥!
### 使用场景
本地数据加密、`https` 通信、网络传输等
## 非对称加密
### 概念
通信的双方使用不同的秘钥进行加密解密，即秘钥对（私钥 + 公钥）。

特征: 私钥可以解密公钥加密的内容, 公钥可以解密私钥加密的内容
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c14f578ba3554a119031472df5cf3935~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)
### 优点
非对称加密与对称加密相比其安全性更好
### 缺点
加密和解密花费时间长、速度慢，只适合对少量数据进行加密
### 使用场景
https 会话前期、CA 数字证书、信息加密、登录认证等

## HTTPS是如何保证安全的
结合**对称加密**和**非对称加密**两种加密⽅式，将**对称加密的密钥使⽤⾮对称加密的公钥进⾏加密**，然后发送出去，接收⽅使⽤私钥进⾏解密得到对称加密的密钥，然后双⽅可以使⽤对称加密来进⾏沟通。
这个时候还需要⼀个安全的第三⽅颁发证书（`CA`），证明双方的身份，**防⽌被中间⼈攻击**。

为了防止中间人篡改证书，需要用到**数字签名**这个技术。

**数字签名**就是⽤`CA`⾃带的`HASH算法`对证书的内容进⾏`HASH`得到⼀个摘要，再⽤`CA`的私钥加密，最终组成数字签名。当别⼈把他的证书发过来的时候,我再⽤同样的`Hash`算法,再次⽣成消息摘要，然后⽤`CA`的公钥对数字签名解密,得到`CA`创建的消息摘要,两者⼀⽐,就知道中间有没有被⼈篡改了。这个时候就能最⼤程度保证通信的安全了。

## 数字证书
### 概念
使用一种 `Hash` 算法来对公钥和其他信息进行加密，生成一个信息摘要，然后让有公信力的认证中心（简称 `CA` ）用它的私钥对消息摘要加密，形成签名。最后将原始的信息和签名合在一起，称为**数字证书**。当接收方收到数字证书的时候，先根据原始信息使用同样的 `Hash` 算法生成一个摘要，然后使用公证处的公钥来对数字证书中的摘要进行解密，最后将解密的摘要和生成的摘要进行对比，就能发现得到的信息是否被更改了。
### 作用
现在的方法也不一定是安全的，因为没有办法确定得到的公钥就一定是安全的公钥。可能存在一个中间人，截取了对方发给我们的公钥，然后将他自己的公钥发送给我们，当我们使用他的公钥加密后发送的信息，就可以被他用自己的私钥解密。然后他伪装成我们以同样的方法向对方发送信息，这样我们的信息就被窃取了，然而自己还不知道。为了解决这样的问题，可以使用数字证书。
### 数字签名
数字签名就是先用`CA`自带的`Hash`算法来计算出证书内容的一个摘要，然后使用`CA`私钥进行加密，组成数字签名。

当别人把他的数字证书发过来时，接收方用同样的算法再次生成摘要，用`CA`公钥解密后得到`CA`生成的摘要，两者进行对比后，就能确定中间是否被人篡改。这样就能最大程度的保证通信的安全了。
## HTTPS通信（握手）过程
HTTPS的通信过程如下：
- 客户端向服务器发起请求，请求中包含使用的协议版本号、生成的一个随机数、以及客户端支持的加密方法。
- 服务器端接收到请求后，确认双方使用的加密方法、并给出服务器的证书、以及一个服务器生成的随机数。
- 客户端确认服务器证书有效后，生成一个新的随机数，并使用数字证书中的公钥，加密这个随机数，然后发给服务器。并且还会提供一个前面所有内容的`hash`的值，用来供服务器检验。
- 服务器使用自己的私钥，来解密客户端发送过来的随机数。并提供前面所有内容的`hash`值来供客户端检验。
- 客户端和服务器端根据约定的加密方法使用前面的三个随机数，生成对话秘钥，以后的对话过程都使用这个秘钥来加密信息。

## HTTPS的优缺点
### 优点
- 使用`HTTPS协议`可以认证用户和服务器，确保数据发送到正确的客户端和服务器;
- 使用`HTTPS协议`可以进行**加密传输**、**身份认证**，**通信更加安全**，防止数据在传输过程中被窃取、修改，确保数据安全性；
- `HTTPS`是现行架构下最安全的解决方案，虽然不是绝对的安全，但是大幅增加了中间人攻击的成本

### 缺点
- `HTTPS`需要做服务器和客户端双方的加密个解密处理，耗费更多服务器资源，过程复杂
- `HTTPS协议`握手阶段比较费时，增加页面的加载时间
- `SSL证书`是收费的，功能越强大的证书费用越高
- `HTTPS`连接服务器端资源占用高很多，支持访客稍多的网站需要投入更大的成本
- `SSL证书`需要绑定`IP`，不能再同一个`IP`上绑定多个域名